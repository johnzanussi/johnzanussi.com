---
import { getItems } from '@utils/collections';
import { getItemImagePath, getRenderedImage } from '@utils/images';
import { absoluteUrl } from '@utils/urls';

import ContentLayout from '@layouts/ContentLayout.astro';
import Markdown from '@components/Markdown.astro';
import PageTitle from '@components/PageTitle.astro';

export async function getStaticPaths() {

    const pages = await getItems('pages');

    return pages.map(page => ({
        params: {
            page: page.slug,
        },
        props: {
            page,
        },
    }));

}

const { page } = Astro.props;
const { Content } = await page.render();

const { data, slug } = page;

const {
    coverImage,
    excerpt,
    title,
} = data;

const ogImageSrc = await getRenderedImage(
    getItemImagePath(slug, coverImage.url, 'pages')
);

const metadata = {
    title,
    description: excerpt,
    image: absoluteUrl(ogImageSrc),
};
---

<ContentLayout metadata={metadata}>

    <PageTitle>
        {title}
    </PageTitle>

    <Markdown Content={Content} />

</ContentLayout>
