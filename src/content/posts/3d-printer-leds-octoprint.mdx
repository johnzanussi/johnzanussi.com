---
title: All-in-One Raspberry Pi, RGB LEDs, Camera, and OctoPrint Solution for 3D Printer 
excerpt: 
coverImage:
    url: ~led-wiring-diagram.jpg
    width: 1600
    height: 900
date: '2023-02-01'
draft: true
---

A while ago I modified my old Ender 3 so that I could easily [turn it on and off via an OctoPrint plugin](/posts/3d-printer-psu-control). Since then I sold the Ender 3 and upgraded to a Prusa i3 MK3S+. I used my own guide to setup the Pi to control the MK3's PSU the same way I did for the Ender 3. I've also got a cheap webcam plugged into the Pi that is viewable through OctoPrint. I also wanted to add strips of individually addressable LED lights to light up the printer while it prints. 

Instead of having a mess of wires and components all over I set out to find a way of mounting the Raspberry Pi, the LED strips, the webcam, and all it's wires neatly to the MK3. While browsing Printablaes one day I came across these [Vertical LED Light Bars](https://www.printables.com/model/81952-vertical-led-light-bars-for-the-prusa-i3-mk3smk3s) that seemed perfect for what I was looking for. I like the vertical bars over the top-mounted horizontal bars as they cast less of a shadow. For the webcam I'm using the [Articulating Raspberry Pi Camera Mount](https://www.printables.com/model/3407-articulating-raspberry-pi-camera-mount-for-prusa-m). 

My solution ended up being a custom designed and printed Raspberry Pi case, a "protype" custom PCB, and clean but modular wiring. Below I'll dive into varrying levels of depth on each of the parts that resulted in the following.

[FINAL PICTURE]

## LEDs
There's a number of ways to control LEDS for this use case. Some printers have connections for them on their motherboards. Unfortuntalty the Einsy RAMBo board Prusa uses for the MK3 series lacks those connections. Another way is to use the popular WLED library and a separate ESP8266/ESP32 dev board. Utilizing the Raspberry Pi running OctoPrint and the [WS281x LED Status](https://plugins.octoprint.org/plugins/ws281x_led_status/) plugin is also a way to go. It's the way I chose. Although it wasn't as easy as installing the plugin and connecting the LED strips to the Pi's GPIO pins.

Fortunately, the WS281x plugin has a [page in it's documentation dedicated to wiring the LED's](https://cp2004.gitbook.io/ws281x-led-status/guides/setup-guide-1/wiring-your-leds). Even though the Pi and the LED strips run on 5 volts, anyone that's used a Pi knows that they are very particular about their power source. I certainly didn't want to cause any issues with OctoPrint during a print by siphoning power away from the Pi to light up some LEDs. The other problem is that the GPIO pins on the Pi output 3.3v and the LEDs expect a 5v signal.

So I needed a way to power the LEDs and Pi separately and convert the 3.3v signal from the Pi to 5v for the LEDs. The WS281x plugin docs do an excellent job of offering some options, and it seemed like the best, and most reliable way is to use a [74AHCT125 level shifting chip](https://amzn.to/3RgU7gY).

![](~led-wiring-diagram.jpg)



To recap, I need something 
* 5v to LEDs from 3D printer's 24v power supply
* Convert 3.3v signal from RPi to 5v for LEDs
* Clean install
* Maintainable


## Case

## Camera

## PSU


## My Requirements
I like to start with a set of requirements for any project I do, either for work or personal.



## Breadboarding + Prototyping
Following the detailed wiring diagram from above, I got all the components hooked up with a breadboard and jumper wires.

<YouTubeEmbed id="0GDUg7PBkDE">https://youtu.be/0GDUg7PBkDE</YouTubeEmbed>

This is all good, but it certainly isn't how I want to deploy it on my printer. Two of my requirements are clean installation and easily maintainable. This is neither. It also lacks the ability to be powered by the printer's PSU.

I returned to the literal drawing board and drew the following on my whiteboard.


24 volts comes in from the printer to a buck converter tuned to output 5 volts [red]. That 5 volts gets sent to the 74AHCT125 and the LED strip [red].
Data from the Raspberry Pi comes in from GPIO pin 16 to the 74AHCT125 and then out to the LED strip [blue]. Everything is grounded together [black].

With my sub-par soldering skills, I picked up a prototype board kit from Amazon and cobbled the following together.


I quickly designed and printed a case for it and installed it on the printer. To my surprise, this worked great, and I've been using it for a few weeks without issue.

## Custom PCB Attempt 1
While the prototype board worked and provided a decent amount of satisfaction, I still wanted more. I kept thinking: "This would probably be useful for others. How can I make it easier?". I understand not everyone will want to buy the parts and tools I did to get LEDs working with their printer. 

A few days passed when I watched a YouTube video from one of the channels I subscribe to, and the video's sponsor was [JLPCB](https://jlcpcb.com/). JLPCB, like a few other similar companies popping up these days, allows you to order custom-printed circuit boards. You design it; they create it. You can also provide them with the parts, and they'll assemble and solder them together.

Well, that sounds fun. I spent a weekend diving into the steps to design and order custom PCBs. YouTube videos, blog reading, Reddit browsing, and browsing JLPCB and PCBWay's website led me to use EasyEDA to create my first PCB.

I sent that through to 

## Custom PCB Attempt 2
While the 




## Install
* Case
* LED mounts [seabazzz]
* Pi Enclosure
* Wiring
* Screenshot


## Retro



Please remember I have no formal education/training when it comes to electrical engineering.
