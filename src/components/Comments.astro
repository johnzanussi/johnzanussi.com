---
export interface Props {
    id: string;
    url: string;
    title: string;
}

const { id, url, title } = Astro.props;
---

<script
    is:inline
    src="https://cdn.fastcomments.com/js/embed-v2.min.js"
/>

<div
    id="fastcomments"
    data-id={id}
    data-url={url}
    data-title={title}
/>

<script>
/* global FastCommentsUI */
const comments = document.getElementById('fastcomments');

if (comments !== null) {

    const getConfig = (theme: string | null) => ({
        tenantId: 'TuZHgHCUlVl',
        urlId: comments.dataset.id,
        url: comments.dataset.url,
        pageTitle: comments.dataset.title,
        hasDarkBackground: theme === 'dark',
    });

    // @ts-expect-error: No type available for FastCommentsUI
    const fastComments = FastCommentsUI(
        comments,
        getConfig(localStorage.getItem('theme'))
    );

    document.addEventListener('theme', (event) => {
        const customEvent = event as CustomEvent;
        fastComments.update(getConfig(customEvent.detail));
    }, false);

}
</script>
