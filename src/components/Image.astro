---
import { Image } from '@astrojs/image/components';
import { getImage } from '@astrojs/image';

import { loadImage } from '@utils/images.js';

const {
    src,
    widths,
    aspectRatio,
    ...props
} = Astro.props;

const image = await loadImage(src);

const format = 'webp';

const responsiveAttrs = {};

if (widths) {

    const srcset = await Promise.all(widths.map(async (width) => {

        const { src } = await getImage({
            src: image,
            width: width,
            aspectRatio: aspectRatio,
            format: format,
        });

        return `${decodeURI(src)} ${width}w`;

    }));

    responsiveAttrs.srcset = srcset.join(', ');
    responsiveAttrs.aspectRatio = aspectRatio;

}

---

<Image
    src={image}
    format={format}
    {...props}
    {...responsiveAttrs}
/>
